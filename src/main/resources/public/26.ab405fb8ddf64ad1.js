"use strict";(self.webpackChunkincident=self.webpackChunkincident||[]).push([[26],{1026:(Ye,I,d)=>{d.r(I),d.d(I,{IncidentModule:()=>Se});var l=d(6814),e=d(4946);const V=[{header:"Code",name:"code",id:"code_incident_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Incident Type Code",name:"incidentTypeCode",id:"incident_type_code_incident_search",defaultValue:"",required:!1,type:"dropdown",isDropDown:{label:"incidentTypeName",options:[],optionsName:"incidentTypeCode",value:"incidentTypeCode"},status:"basic"},{header:"Tgh Code",name:"tghCode",id:"tgh_code_incident_search",defaultValue:"",required:!1,type:"textarea",status:"basic"},{header:"Telegraph ID",name:"telegraphId",id:"telegraph_id_incident_search",defaultValue:"",required:!1,type:"text",status:"basic",icon:!0},{header:"Status Code",name:"statusCode",id:"status_code_incident_search",defaultValue:"",required:!1,type:"dropdown",status:"basic",isDropDown:{label:"statusName",options:[],optionsName:"statusCode",value:"statusCode"}},{header:"Tgh Date",name:"tghDate",id:"tgh_date_incident_search",defaultValue:"",required:!1,type:"date",status:"basic",showTime:!1},{header:"Caller Name",name:"callerName",id:"caller_name_incident_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Caller City Code",name:"callerCityCode",id:"caller_city_code_incident_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Seq No",name:"seqNo",id:"seq_no_incident_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Caller Address",name:"callerAddress",id:"caller_address_incident_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Recieved By",name:"recievedBy",id:"recievedby_incident_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Caller Tel No",name:"callerTelNo",id:"caller_tel_no_incident_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Customer Mobile Number",name:"customerMobileNumber",id:"customer_mob_no_incident_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Recieved Date",name:"recievedDate",id:"recieveddate_incident_search",defaultValue:"",required:!1,type:"date",status:"basic",showTime:!1}],E=["1_code","1_recievedDate","1_recievedBy","1_tghCode","1_tghDate","1_incidentTypeCode"];var h=d(8268),_=d(1252),u=d(7417),g=d(7553),m=d(9627),N=d(8478),f=d(7759),A=d(7057),b=d(8180),D=d(986),y=d(8355),v=d(6725);const Z=[{header:"Telegraph Code",name:"tghCode",id:"code_tgh_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"bill Tel No",name:"billTelNo",id:"billTelNo_tgh_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"national Id",name:"nationalId",id:"nationalId_tgh_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Caller Name",name:"callerName",id:"callerName_tgh_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Caller Tel No",name:"callerTelNo",id:"callerTelNo_tgh_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Recipient Name",name:"recipientName",id:"recipientName_tgh_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Telegraph Date",name:"thgDate",id:"tghDate_tgh_search",defaultValue:"",required:!1,type:"date",status:"basic"}],q=["1_tghId","1_nationalId","1_billTelNo","1_tghCode","1_thgDate","1_callerTelNo","1_callerName","1_recipientName","1_callDate"];let S=(()=>{class i{constructor(t,a,s,n){this.toast=t,this.apis=a,this.shared_service=s,this.cdr=n,this.search_cols=[],this.cols=[],this.thgDataHeaders=q,this.loading=!1,this.tgh_data=[],this.pageNumber=0,this.pageSize=50,this.totalRecords=0,this.tgh_clicked=new e.vpe}ngOnInit(){this.search_cols=this.shared_service.translate(Z),this.form=this.shared_service.create_form_by_cols(this.search_cols),this.cols=this.shared_service.get_cols_by_fileds_and_headers(this.thgDataHeaders)}search(t){this.loading=!0,this.tgh_data=[],this.apis.get_telegraphs(t.value,this.pageNumber,this.pageSize).subscribe(a=>{Array.isArray(a.body?.result)&&(this.tgh_data=a.body?.result,this.totalRecords=a.body?.totalSize),this.loading=!1,this.cdr.detectChanges()},a=>{this.loading=!1,this.toast.showAlert("error","Error",a.clientMessage)},()=>{}),this.pageNumber=0,this.pageSize=50}telegraph_selected(t){if("Paginate"==t.type)return this.pageNumber=t.value.page,this.pageSize=t.value.rows,this.search(this.form),void console.log("nnnnnnnn",t.value.page);"Row"==t.type&&this.tgh_clicked.emit(t.value)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(u.k),e.Y36(_.b),e.Y36(h.F),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-telegraph"]],outputs:{tgh_clicked:"tgh_clicked"},decls:3,vars:11,consts:[[3,"form","reset","action","cols","onSubmit"],[3,"cols","data","loading","selected","height","paginator","totalRecords","btn_click"],["TableComponent",""]],template:function(t,a){1&t&&(e.TgZ(0,"mts-form",0),e.NdJ("onSubmit",function(n){return a.search(n)}),e.qZA(),e.TgZ(1,"mts-table",1,2),e.NdJ("btn_click",function(n){return a.telegraph_selected(n)}),e.qZA()),2&t&&(e.Q6J("form",a.form)("reset",!0)("action","search")("cols",a.search_cols),e.xp6(1),e.Q6J("cols",a.cols)("data",a.tgh_data)("loading",a.loading)("selected",!0)("height",300)("paginator",!0)("totalRecords",a.totalRecords))},dependencies:[y.U,f.a]}),i})();const J=["telegraph_modal"];function Q(i,o){1&i&&e.GkF(0)}function B(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"app-telegraph",5),e.NdJ("tgh_clicked",function(s){e.CHM(t);const n=e.oxw();return e.KtG(n.close_and_set_tgh_id(s))}),e.qZA()}}let G=(()=>{class i{constructor(t,a,s,n,r,c){this.sharedService=t,this.apis=a,this.lkps=s,this.translate=n,this.softSave=r,this.datePipe=c,this.search_event=new e.vpe,this.lang="ar",this.header="tghId",this.lang=this.translate.get_app_lang()}ngOnInit(){this.cols=this.sharedService.translate(V),this.cols.map(t=>t.status="basic"),this.form=this.sharedService.create_form_by_cols(this.cols),this.handleInitSearch(),this.track_lkps(),this.lkps.get_lkp_status_code(),this.lkps.get_lkp_type_code()}track_lkps(){this.lkps.lkp_incident_status_code.pipe((0,b.q)(1)).subscribe(t=>{this.cols.map(a=>{a.isDropDown&&"statusCode"==a.name&&(a.isDropDown.options=t)})}),this.lkps.lkp_incident_type_code.pipe((0,b.q)(1)).subscribe(t=>{this.cols.map(a=>{a.isDropDown&&"incidentTypeCode"==a.name&&(a.isDropDown.options=t)})})}search({value:t}){let s=this.sharedService.convertDatePropsToString(t);s.tghId=this.form.controls.telegraphId.value,delete s.telegraphId,this.emitTable(s),this.softSave.setFormValueInLS(s),console.log("sss",s)}emitTable(t={}){this.search_event.emit(t)}searchByInput(t){this.telegraph_modal?.clickOnButton("open")}close_and_set_tgh_id(t){this.form.controls.telegraphId.patchValue(t.tghId),this.telegraph_modal?.clickOnButton("close")}handleInitSearch(){if(this.softSave.softSave$){let a=this.softSave.getFormValueFromLS();this.emitTable(a),this.form.patchValue(a)}else this.emitTable()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.F),e.Y36(_.b),e.Y36(D.z),e.Y36(m.s),e.Y36(N.a),e.Y36(l.uU))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-search-incident"]],viewQuery:function(t,a){if(1&t&&e.Gf(J,5),2&t){let s;e.iGM(s=e.CRH())&&(a.telegraph_modal=s.first)}},outputs:{search_event:"search_event"},decls:6,vars:9,consts:[[3,"reset","action","form","nCols","cols","input_search","onSubmit"],[3,"size","modal_name","header_name"],["telegraph_modal",""],[4,"ngTemplateOutlet"],["myComponent",""],[3,"tgh_clicked"]],template:function(t,a){if(1&t&&(e.TgZ(0,"mts-form",0),e.NdJ("input_search",function(n){return a.searchByInput(n)})("onSubmit",function(n){return a.search(n)}),e.qZA(),e.TgZ(1,"mts-modal",1,2),e.YNc(3,Q,1,0,"ng-container",3),e.qZA(),e.YNc(4,B,1,0,"ng-template",null,4,e.W1O)),2&t){const s=e.MAs(5);e.Q6J("reset",!0)("action","search")("form",a.form)("nCols",3)("cols",a.cols),e.xp6(1),e.Q6J("size","modal-xl")("modal_name","search-telegraph")("header_name",a.header),e.xp6(2),e.Q6J("ngTemplateOutlet",s)}},dependencies:[l.tP,y.U,v.z,S],changeDetection:0}),i})();const O=["add_adit_incident"];let H=(()=>{class i{constructor(t,a,s,n,r,c){this.sharedService=t,this.apis=a,this.toast=s,this.router=n,this.translateService=r,this.softSave=c,this.cols=[],this.loading=!1,this.incidentDataHeaders=E,this.incidentData=[],this.lang="ar",this.currentCode="",this.breadcumb={}}ngOnInit(){this.lang=this.translateService.get_app_lang(),this.cols=this.sharedService.get_cols_by_fileds_and_headers(this.incidentDataHeaders)}get_incident_data(t){""==t.customerMobileNumber&&(t.customerMobileNumber=null),this.saveForm(t),this.loading=!0,this.incidentData=[],this.apis.get_incident_data(t).subscribe(a=>{this.loading=!1,Array.isArray(a.body)&&(this.incidentData=a.body)},a=>{this.loading=!1,this.toast.showAlert("error","Error","there no data")},()=>{})}saveForm(t){let a=this.sharedService.ignoreHiddenFields(this.cols,t.value);this.softSave.formSoftSave({cols:this.cols,value:a})}open_add_edit_incident(t){this.code=t.value.code,"Edit"==t.type?(this.softSave.setIdsInLS(this.incidentData,"code",this.code),this.router.navigate([`/incident/Edit/${this.code}`])):"Add"==t.type&&this.router.navigate(["/incident/Add"])}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.F),e.Y36(_.b),e.Y36(u.k),e.Y36(g.F0),e.Y36(m.s),e.Y36(N.a))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-table-incident"]],viewQuery:function(t,a){if(1&t&&e.Gf(O,5),2&t){let s;e.iGM(s=e.CRH())&&(a.add_adit_incident=s.first)}},decls:3,vars:6,consts:[["title","Incident"],[3,"search_event"],[3,"id","cols","data","show_edit","loading","show_add","btn_click"]],template:function(t,a){1&t&&(e._UZ(0,"mts-header-breadcrumb",0),e.TgZ(1,"app-search-incident",1),e.NdJ("search_event",function(n){return a.get_incident_data(n)}),e.qZA(),e.TgZ(2,"mts-table",2),e.NdJ("btn_click",function(n){return a.open_add_edit_incident(n)}),e.qZA()),2&t&&(e.xp6(2),e.Q6J("id","incidentTableID")("cols",a.cols)("data",a.incidentData)("show_edit",!0)("loading",a.loading)("show_add","ar"==a.lang?"\u0627\u0636\u0627\u0641\u0629 \u0628\u0644\u0627\u063a":"Add Incident"))},dependencies:[f.a,A.S,G]}),i})(),P=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-incident"]],decls:1,vars:0,template:function(t,a){1&t&&e._UZ(0,"app-table-incident")},dependencies:[H]}),i})();var R=d(7269),U=d(9726);const z=[{header:"Code",name:"code",id:"code_add",defaultValue:"",required:!1,type:"text",status:"readonly"},{header:"Recieved Date",name:"recievedDate",id:"recieveddate_add",defaultValue:"",required:!1,type:"date",status:"disabled"},{header:"Recieved By",name:"recievedBy",id:"recievedby_add",defaultValue:"",required:!1,type:"text",status:"readonly"},{header:"Telegraph ID",name:"tghId",id:"telegraph_id_add",defaultValue:"",required:!1,type:"text",status:"basic",icon:!0},{header:"Query Flag",name:"queryFlag",id:"query_flag_add",defaultValue:"",required:!1,type:"checkbox",status:"disabled"},{header:"Caller Name",name:"callerName",id:"caller_name_add",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Caller Address",name:"callerAddress",id:"caller_address_add",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Caller City Code",name:"callerCityCode",id:"caller_city_code_add",defaultValue:"",required:!0,type:"text",status:"basic",icon:!0},{header:"Caller Tel No",name:"callerTelNo",id:"caller_tel_no_add",defaultValue:"",required:!0,type:"text",status:"basic"},{header:"Customer Mobile Number",name:"customerMobileNumber",id:"customer_mob_no_incident_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"Incident Type Code",name:"incidentTypeCode",id:"incident_type_code_add",defaultValue:"",required:!1,type:"dropdown",status:"basic",isDropDown:{label:"incidentTypeName",options:[],optionsName:"incidentTypeCode",value:"incidentTypeCode"}},{header:"Status Code",name:"statusCode",id:"status_code_add",defaultValue:"",required:!0,type:"dropdown",status:"basic",isDropDown:{label:"statusName",options:[],optionsName:"statusCode",value:"statusCode"}},{header:"Incident Notes",name:"incidentNotes",id:"incident_notes_add",defaultValue:"",required:!1,type:"textarea",status:"basic"}];var x=d(8690),j=d(1426),X=d(9862),k=d(11),w=d(5406),Y=d(870);const L=[["vipNo",0],["recipientVIP",0]],K=["1_senderName","1_billTelNo","1_notes"],W=["1_recipientTelNo","1_recipientName","1_address"],$=["genId","userCode","callDate","callerTelNo","callerName","billTelNo","sendDate","countryCode","langCode","planCode","template","tempTypeCode","tempCode","deliveryNotice","decoration","urgent","admin","international","notes","message"];var T=d(799);const ee=["labels_comp"];let te=(()=>{class i{constructor(t,a,s,n,r){this.apis=t,this.toast=a,this.sharedService=s,this.datePipe=n,this.translate=r,this.generator_data=void 0,this.headers=$,this.checkboxArray=L,this.checkBoxMap=new Map(this.checkboxArray),this.sender_headers=K,this.recipient_headers=W,this.loading=!1,this.lang="ar",this.header="Senders",this.header2="Receipents",this.rec=[],this.sen=[],this.lang=this.translate.get_app_lang(),this.setHeader(),this.show_lables()}setHeader(){"ar"==this.lang?(this.header="\u0627\u0644\u0645\u064f\u0631\u0633\u0650\u0644\u064a\u0646",this.header2="\u0627\u0644\u0645\u064f\u0631\u0633\u064e\u0644 \u0627\u0644\u064a\u0647\u0645"):(this.header="Senders",this.header2="Receipents")}get_generator(t){this.loading=!0,this.apis.get_generator_by_id(t).subscribe(a=>{this.generator_data=a.body,this.generator_data.callDate=this.datePipe.transform(this.generator_data.callDate,"dd-MM-yyyy HH:mm"),this.generator_data.sendDate=this.datePipe.transform(this.generator_data.sendDate,"dd-MM-yyyy HH:mm"),this.loading=!1,Array.isArray(a.body.senders)&&(this.sen=a.body.senders.slice()),Array.isArray(a.body.recepients)&&(this.rec=a.body.recepients.slice()),delete this.generator_data.senders,delete this.generator_data.recepients,setTimeout(()=>{this.labels_comp.set_labels(this.generator_data,this.checkBoxMap,"ginDetails")},100),console.log("generator data",this.generator_data)},a=>{this.loading=!1},()=>{})}show_lables(){this.sender_cols=this.sharedService.get_cols_by_fileds_and_headers(this.sender_headers),this.recipient_cols=this.sharedService.get_cols_by_fileds_and_headers(this.recipient_headers)}tabChanged(t){}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(_.b),e.Y36(u.k),e.Y36(h.F),e.Y36(l.uU),e.Y36(m.s))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-gen-id-details"]],viewQuery:function(t,a){if(1&t&&e.Gf(ee,5),2&t){let s;e.iGM(s=e.CRH())&&(a.labels_comp=s.first)}},decls:7,vars:9,consts:[["labels_comp",""],[3,"header"],[3,"id","cols","data","loading"],[3,"id","cols","data"]],template:function(t,a){1&t&&(e._UZ(0,"app-labels-form",null,0),e.TgZ(2,"p-tabView")(3,"p-tabPanel",1),e._UZ(4,"mts-table",2),e.qZA(),e.TgZ(5,"p-tabPanel",1),e._UZ(6,"mts-table",3),e.qZA()()),2&t&&(e.xp6(3),e.Q6J("header",a.header2),e.xp6(1),e.Q6J("id","receipentsTableID")("cols",a.recipient_cols)("data",a.rec)("loading",a.loading),e.xp6(1),e.Q6J("header",a.header),e.xp6(1),e.Q6J("id","sendersTableID")("cols",a.sender_cols)("data",a.sen))},dependencies:[f.a,T.xf,T.x4,Y.x]}),i})();const ae=["gen_id_details"],se=["generator_modal"],ie=["labels_comp"];function ne(i,o){1&i&&e.GkF(0)}function oe(i,o){1&i&&e._UZ(0,"app-gen-id-details",null,6)}let de=(()=>{class i{constructor(t,a,s,n,r,c){this.apis=t,this.incidentService=a,this.toast=s,this.sharedService=n,this.permissionsService=r,this.translate=c,this.tgh_code=0,this.data=[],this.loading=!1,this.checkboxArray=x.S,this.checkBoxMap=new Map(this.checkboxArray),this.headers=x.w,this.lang="ar",this.preCode="-1",this.lang=this.translate.get_app_lang(),[this.incidentGenPermission]=this.permissionsService.havePermissions(["TelegraphGenerator.view"])}ngOnInit(){this.incidentService.getTghId().pipe((0,j.b)(200)).subscribe(t=>{t!==this.tgh_code&&(this.tgh_code=t,this.get_telegraphs_details(t))})}ngOnChanges(t){console.warn(t)}get_telegraphs_details(t){if(console.log("incident"),"-1"!==this.preCode)this.preCode=t;else if(this.preCode==t||""==t)return;const a=(new X.LE).set("loader","no");this.apis.get_tgh_details(t,a).subscribe(s=>{this.data=s.body,this.genid=this.data.genId,this.labels_comp?.set_labels(this.data,this.checkBoxMap,"tghDetails")},s=>{},()=>{})}get_gen_details(){this.gen_id_details?.get_generator(this.genid),this.generator_modal?.clickOnButton("open")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(_.b),e.Y36(k.k),e.Y36(u.k),e.Y36(h.F),e.Y36(w.q),e.Y36(m.s))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-telegraph-details"]],viewQuery:function(t,a){if(1&t&&(e.Gf(ae,5),e.Gf(se,5),e.Gf(ie,5)),2&t){let s;e.iGM(s=e.CRH())&&(a.gen_id_details=s.first),e.iGM(s=e.CRH())&&(a.generator_modal=s.first),e.iGM(s=e.CRH())&&(a.labels_comp=s.first)}},inputs:{tgh_code:"tgh_code"},features:[e.TTD],decls:7,vars:4,consts:[[3,"get_gen"],["labels_comp",""],[3,"size","modal_name","header_name"],["generator_modal",""],[4,"ngTemplateOutlet"],["myComponent",""],["gen_id_details",""]],template:function(t,a){if(1&t&&(e.TgZ(0,"app-labels-form",0,1),e.NdJ("get_gen",function(){return a.incidentGenPermission&&a.get_gen_details()}),e.qZA(),e.TgZ(2,"mts-modal",2,3),e.YNc(4,ne,1,0,"ng-container",4),e.qZA(),e.YNc(5,oe,2,0,"ng-template",null,5,e.W1O)),2&t){const s=e.MAs(6);e.xp6(2),e.Q6J("size","modal-xl")("modal_name","gen-id-telegraph")("header_name","ar"==a.lang?"\u0639\u0631\u0636 \u0627\u0644\u0628\u0631\u0642\u064a\u0629 \u0627\u0644\u0627\u0635\u0644\u064a\u0629":"View Gen Id Details"),e.xp6(2),e.Q6J("ngTemplateOutlet",s)}},dependencies:[l.tP,v.z,Y.x,te]}),i})();var re=d(8404),F=d(7023);const le=[{header:"City Code",name:"cityCode",id:"city_code_caller_city_search",defaultValue:"",required:!1,type:"text",status:"basic"},{header:"City Name",name:"cityName",id:"city_name_caller_city_search",defaultValue:"",required:!1,type:"text",status:"basic"}],ce=["1_cityName"];let he=(()=>{class i{constructor(t,a,s){this.shared_service=t,this.toast=a,this.apis=s,this.caller_city_clicked=new e.vpe,this.search_cols=[],this.cols=[],this.caller_city_data=[],this.modal_header="Search and Select Caller City Code",this.loading=!1}ngOnInit(){this.search_cols=this.shared_service.translate(le),this.form=this.shared_service.create_form_by_cols(this.search_cols),this.cols=this.shared_service.get_cols_by_fileds_and_headers(ce)}search({value:t}){this.loading=!0,this.caller_city_data=[],this.apis.get_city_codes(t).subscribe(s=>{this.loading=!1,Array.isArray(s.body)&&(console.log("result",s),this.caller_city_data=s.body)},s=>{this.loading=!1},()=>{})}caller_city_selected({value:t}){this.caller_city_clicked.emit(t)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.F),e.Y36(u.k),e.Y36(_.b))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-caller-city"]],outputs:{caller_city_clicked:"caller_city_clicked"},decls:2,vars:10,consts:[[3,"form","reset","action","nCols","cols","onSubmit"],[3,"id","cols","data","selected","loading","btn_click"]],template:function(t,a){1&t&&(e.TgZ(0,"mts-form",0),e.NdJ("onSubmit",function(n){return a.search(n)}),e.qZA(),e.TgZ(1,"mts-table",1),e.NdJ("btn_click",function(n){return a.caller_city_selected(n)}),e.qZA()),2&t&&(e.Q6J("form",a.form)("reset",!0)("action","search")("nCols",2)("cols",a.search_cols),e.xp6(1),e.Q6J("id","callerCityTableID")("cols",a.cols)("data",a.caller_city_data)("selected",!0)("loading",a.loading))},dependencies:[y.U,f.a]}),i})();const _e=["follow_up_comp"],pe=["search_modal"];function ue(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"mts-paginator",9),e.NdJ("moveTo",function(s){e.CHM(t);const n=e.oxw();return e.KtG(n.ChangeTitle(s))}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("breadcrumb",t.breadcrumb)}}function me(i,o){1&i&&e._UZ(0,"mts-header-breadcrumb",10)}function ge(i,o){1&i&&e.GkF(0)}function fe(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.archive_incident())}),e._uU(1),e.qZA()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Oqu(t.buttonName)}}function be(i,o){if(1&i&&(e.TgZ(0,"button",14),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Oqu(t.buttonName2)}}function ye(i,o){if(1&i&&(e.YNc(0,fe,2,1,"button",11),e.YNc(1,be,2,1,"button",12)),2&i){const t=e.oxw();e.Q6J("ngIf",t.archivePermission&&"Add"!==t.current_status&&("1"==t.archFlag||"0"==t.closeFlag)),e.xp6(1),e.Q6J("ngIf","Add"!==t.current_status)}}function Ce(i,o){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"mts-tabs-view",15),e.NdJ("tabChangedTo",function(s){e.CHM(t);const n=e.oxw();return e.KtG(n.tabChanged(s))}),e.qZA(),e.BQk()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("tabs",t.tabs)}}function ve(i,o){1&i&&e.GkF(0)}function Te(i,o){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-telegraph",16),e.NdJ("tgh_clicked",function(s){e.CHM(t);const n=e.oxw(2);return e.KtG(n.set_thg_id(s))}),e.qZA(),e.BQk()}}function Ie(i,o){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-caller-city",17),e.NdJ("caller_city_clicked",function(s){e.CHM(t);const n=e.oxw(2);return e.KtG(n.set_caller_city(s))}),e.qZA(),e.BQk()}}function Ne(i,o){if(1&i&&(e.YNc(0,Te,2,0,"ng-container",5),e.YNc(1,Ie,2,0,"ng-container",5)),2&i){const t=e.oxw();e.Q6J("ngIf","tghId"==t.current_model),e.xp6(1),e.Q6J("ngIf","callerCityCode"==t.current_model)}}let M=(()=>{class i{constructor(t,a,s,n,r,c,p,C,xe,ke,we){this.service=t,this.apis=a,this.savedDataService=s,this.lkps=n,this.toast=r,this.translate=c,this.datePipe=p,this.router=C,this.sharedService=xe,this.permissionsService=ke,this.cdr=we,this.refresh_incident_table=new e.vpe,this.current_model="",this.header_name="Manage Incident",this.loading=!1,this.archivePermission=!1,this.lang="ar",this.tabs=[],this.buttonName="Archive Incident",this.buttonName2="Add Incident",this.showTabs=!1,this.currentCode="",this.breadcrumb={},this.closeFlag=1,[this.archivePermission]=this.permissionsService.havePermissions(["TghIncident.archive"]),this.code=C.url.split("/")[3],this.enable_controls_in_edit=["statusCode","incidentNotes"],this.disable_controls_in_add=["code","recievedDate","recievedBy"],this.current_status="Add",this.lang=this.translate.get_app_lang(),"ar"==this.lang&&(this.buttonName="\u0627\u0631\u0634\u0641\u0629 \u0627\u0644\u0628\u0644\u0627\u063a",this.buttonName2="\u0627\u0636\u0627\u0641\u0629 \u0628\u0644\u0627\u063a"),this.tabs=[{header:"IncidentFollow",component:U.c},{header:"TelegraphDetails",component:de}]}ngAfterContentChecked(){this.cdr.detectChanges()}ngOnInit(){this.getCurentStatus(),this.setColumns(),this.createForm(),this.full_incident_form(this.incident_data_obj,this.current_status),this.track_lkps(),this.lkps.get_lkp_status_code(),this.lkps.get_lkp_type_code(),this.setBreadcrumb()}getCurentStatus(){this.router.url.includes("Add")?this.current_status="Add":this.router.url.includes("Edit")&&(this.current_status="Edit")}setBreadcrumb(t=this.code){let a=Object.assign({},this.breadcrumb);a.url="/incident","Add"!==this.current_status?(this.showTabs=!0,a.titles=["EditIncident",`${t}`]):(a.titles=["AddIncident"],this.showTabs=!1),this.breadcrumb=Object.assign({},a)}ChangeTitle(t){this.code=t,this.get_data(t),this.setBreadcrumb(),console.log("id",t),this.router.navigate([`/incident/Edit/${t}`])}get_data(t){this.loading=!0,this.apis.get_dataByCode(t).subscribe(a=>{this.archFlag=a.body.statusCode.supportArchive,console.log("this.archFlag",this.archFlag),this.closeFlag=a.body.statusCode.isClosed,console.log("this.closeFlag",this.closeFlag),"0"==this.closeFlag?(this.form.controls.statusCode.disable(),this.form.controls.incidentNotes.disable()):"1"==this.closeFlag&&(this.form.controls.statusCode.enable(),this.form.controls.incidentNotes.enable()),this.telId=a.body.tghId,this.savedDataService.setTghId(this.telId);const s=a.body?.incidentTypeCode?.incidentTypeCode,n=a.body?.statusCode?.statusCode;this.typeCode=s,a.body.incidentTypeCode=s,a.body.statusCode=n,this.loading=!1,this.form.patchValue(a.body)})}track_lkps(){this.lkps.lkp_incident_status_code.pipe((0,b.q)(1)).subscribe(t=>{this.cols.map(a=>{a.isDropDown&&"statusCode"==a.name&&(a.isDropDown.options=t)})}),this.lkps.lkp_incident_type_code.pipe((0,b.q)(1)).subscribe(t=>{this.cols.map(a=>{a.isDropDown&&"incidentTypeCode"==a.name&&(a.isDropDown.options=t)})})}add_incident({value:t,invalid:a}){this.closeFlag=1,console.log("value.statusCode",t.statusCode),console.log("vv",this.form),console.log(",,,",this.archFlag);let s=Object.assign({},t);if(""==s.customerMobileNumber&&(s.customerMobileNumber=null),a)return void this.toast.showError("Please complete all required fields");if(null!==s.customerMobileNumber&&11!==s.customerMobileNumber?.length)return void this.toast.showWarning("Customer Number Must Be 11 Numbers");const r=this.datePipe.transform(new Date,"dd/MM/yyyy HH:mm");let c=localStorage.getItem("username")||"default username";s.recievedBy=c,s.recievedDate=r,"Add"==this.current_status&&(this.closeFlag=1,this.apis.add_incident_data(s).subscribe(p=>{this.toast.showAlert("success","Success",p.clientMessage),this.refresh_incident_table.emit(),this.current_status="Edit";const C=p.body.incidentId;setTimeout(()=>{this.router.navigate([`/incident/Edit/${C}`])},1e3)},p=>{})),"Edit"==this.current_status&&(t.incidentTypeCode=this.typeCode,t.statusCode=t.statusCode,this.apis.update_incident_data(t).subscribe(p=>{this.toast.showAlert("success","Success",p.clientMessage),this.get_data(this.code),this.refresh_incident_table.emit()}))}generate_code(){this.incident_data_obj.code="default code",this.form.patchValue(this.incident_data_obj),this.apis.get_generate_code().subscribe(t=>{this.incident_data_obj.code=t.body,this.form.patchValue(this.incident_data_obj)},t=>{})}full_incident_form(t,a){this.incident_data_obj=Object.assign({},t),"Edit"==a?(this.cols[3].icon=!1,this.cols[7].icon=!1,this.trigger_form_controls(this.enable_controls_in_edit,"enabled"),this.get_data(this.code),this.savedDataService.setIncidentCode(this.code),this.incident_data_obj.code=this.code,this.form.patchValue(this.incident_data_obj)):"Add"==a&&(this.cols[3].icon=!0,this.cols[7].icon=!0,this.incident_data_obj.recievedDate=new Date,this.incident_data_obj.recievedBy=localStorage.getItem("username")||"default username",this.form.controls.recievedBy.patchValue(this.incident_data_obj.recievedBy),this.generate_code(),this.trigger_form_controls(this.disable_controls_in_add,"disabled"))}setColumns(){this.cols=this.service.translate(z)}createForm(){this.form=this.service.create_form_by_cols(this.cols),this.cols.map(t=>{"disabled"==t.status&&this.form.controls[t.name].disable()})}searchByInput(t){this.current_model=t,this.header=t,this.search_modal.clickOnButton("open")}set_caller_city(t){this.form.controls.callerCityCode.patchValue(t.cityCode),this.close_modal()}set_thg_id(t){this.form.controls.tghId.patchValue(t.tghId),this.close_modal()}close_modal(){this.search_modal.clickOnButton("close")}trigger_form_controls(t,a){"enabled"==a?(this.form.disable(),t.forEach(s=>{this.form.controls[s].enable()})):(this.form.enable(),t.forEach(s=>{this.form.controls[s].disable()}))}reset_form(){this.form.reset()}archive_incident(){this.loading=!0,this.apis.archive_incident(this.code).subscribe(t=>{this.toast.showSuccess(t.clientMessage),this.router.navigate(["/incident"]),this.loading=!1},t=>{this.toast.showError(t.message)})}tabChanged(t){}ngOnDestroy(){this.tabs=[]}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.F),e.Y36(_.b),e.Y36(k.k),e.Y36(D.z),e.Y36(u.k),e.Y36(m.s),e.Y36(l.uU),e.Y36(g.F0),e.Y36(h.F),e.Y36(w.q),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-add-edit-incident"]],viewQuery:function(t,a){if(1&t&&(e.Gf(_e,5),e.Gf(pe,5)),2&t){let s;e.iGM(s=e.CRH())&&(a.follow_up_comp=s.first),e.iGM(s=e.CRH())&&(a.search_modal=s.first)}},outputs:{refresh_incident_table:"refresh_incident_table"},decls:13,vars:12,consts:[[3,"breadcrumb","moveTo",4,"ngIf","ngIfElse"],["el",""],[3,"form","action","form_width","nCols","cols","input_search","onSubmit"],[4,"ngTemplateOutlet"],["addtionalButtons",""],[4,"ngIf"],[3,"modal_name","header_name"],["search_modal",""],["myComponent",""],[3,"breadcrumb","moveTo"],["title","AddIncident"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","btn btn-primary","routerLink","/incident/Add","style","position: absolute;left: 10px;",4,"ngIf"],[1,"btn","btn-primary",3,"click"],["routerLink","/incident/Add",1,"btn","btn-primary",2,"position","absolute","left","10px"],[3,"tabs","tabChangedTo"],[3,"tgh_clicked"],[3,"caller_city_clicked"]],template:function(t,a){if(1&t&&(e.YNc(0,ue,1,1,"mts-paginator",0),e.YNc(1,me,1,0,"ng-template",null,1,e.W1O),e.TgZ(3,"mts-form",2),e.NdJ("input_search",function(n){return a.searchByInput(n)})("onSubmit",function(n){return a.add_incident(n)}),e.YNc(4,ge,1,0,"ng-container",3),e.qZA(),e.YNc(5,ye,2,2,"ng-template",null,4,e.W1O),e.YNc(7,Ce,2,1,"ng-container",5),e.TgZ(8,"mts-modal",6,7),e.YNc(10,ve,1,0,"ng-container",3),e.qZA(),e.YNc(11,Ne,2,2,"ng-template",null,8,e.W1O)),2&t){const s=e.MAs(2),n=e.MAs(6),r=e.MAs(12);e.Q6J("ngIf",a.showTabs)("ngIfElse",s),e.xp6(3),e.Q6J("form",a.form)("action",1==a.closeFlag?"save":"none")("form_width",100)("nCols",2)("cols",a.cols),e.xp6(1),e.Q6J("ngTemplateOutlet",n),e.xp6(3),e.Q6J("ngIf","Add"!==a.current_status),e.xp6(1),e.Q6J("modal_name","search_modal")("header_name",a.header),e.xp6(2),e.Q6J("ngTemplateOutlet",r)}},dependencies:[l.O5,l.tP,g.rH,y.U,v.z,A.S,re.J,F.C,S,he]}),i})();var Ae=d(6812);const De=[{path:"",component:P},{path:"Add",component:M},{path:"Edit/:id",component:M}];let Se=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[l.uU],imports:[l.ez,R.m,T.LU,F.C,g.Bz.forChild(De),Ae.t]}),i})()}}]);